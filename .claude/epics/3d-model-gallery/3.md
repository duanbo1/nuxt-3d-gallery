---
name: Data Schema & Validation Layer
status: open
created: 2025-10-23T05:35:03Z
updated: 2025-10-23T07:00:03Z
github: https://github.com/duanbo1/nuxt-3d-gallery/issues/3
depends_on: [2]
parallel: false
conflicts_with: []
---

# Task: Data Schema & Validation Layer

## Description
Design and implement the data schema for the 3D Model Gallery using JSON files with Zod validation. Create the structure for models.json and categories.json, populate with sample data, and establish build-time validation to ensure data integrity throughout the development lifecycle.

## Acceptance Criteria
- [ ] Zod schemas defined for Model and Category types
- [ ] TypeScript interfaces auto-generated from Zod schemas
- [ ] models.json created with 5-10 sample models
- [ ] categories.json created with initial categories
- [ ] Sample 3D model files (.glb) added to /public/models
- [ ] Sample thumbnail images added to /public/thumbnails
- [ ] Build-time validation script that fails build on invalid JSON
- [ ] Documentation of JSON schema structure in README or separate docs
- [ ] Data validation utilities exported for use in composables

## Technical Details

### Implementation Approach

1. **Create Zod Schema File** (`/schemas/model.schema.ts`):
   ```typescript
   import { z } from 'zod'

   // Format schema
   export const FormatSchema = z.object({
     type: z.enum(['GLB', 'GLTF', 'FBX', 'OBJ', 'USDZ']),
     size: z.string().regex(/^\d+(\.\d+)?(KB|MB|GB)$/), // e.g., "2.4MB"
     url: z.string().url()
   })

   // SEO metadata schema
   export const SeoMetadataSchema = z.object({
     title: z.string().min(10).max(60),
     description: z.string().min(50).max(160),
     keywords: z.array(z.string()).min(1).max(10)
   })

   // Model schema
   export const ModelSchema = z.object({
     id: z.string().regex(/^model-\d{3,}$/), // e.g., "model-2"
     name: z.string().min(3).max(100),
     slug: z.string().regex(/^[a-z0-9-]+$/),
     description: z.string().min(20).max(500),
     thumbnail: z.string().startsWith('/thumbnails/'),
     modelUrl: z.string().startsWith('/models/'),
     formats: z.array(FormatSchema).min(1),
     category: z.string(),
     tags: z.array(z.string()).min(1).max(10),
     polycount: z.number().positive().optional(),
     createdAt: z.string().datetime(),
     updatedAt: z.string().datetime(),
     downloads: z.number().int().nonnegative().default(0),
     license: z.string().default('CC BY 4.0'),
     author: z.string().min(2).max(50),
     seo: SeoMetadataSchema
   })

   // Models collection schema
   export const ModelsCollectionSchema = z.object({
     models: z.array(ModelSchema)
   })

   // Category schema
   export const CategorySchema = z.object({
     id: z.string().regex(/^[a-z0-9-]+$/),
     name: z.string().min(2).max(50),
     slug: z.string().regex(/^[a-z0-9-]+$/),
     icon: z.string().optional(),
     description: z.string().min(10).max(200)
   })

   // Categories collection schema
   export const CategoriesCollectionSchema = z.object({
     categories: z.array(CategorySchema)
   })

   // Export TypeScript types
   export type Model = z.infer<typeof ModelSchema>
   export type Format = z.infer<typeof FormatSchema>
   export type Category = z.infer<typeof CategorySchema>
   export type ModelsCollection = z.infer<typeof ModelsCollectionSchema>
   export type CategoriesCollection = z.infer<typeof CategoriesCollectionSchema>
   ```

2. **Create Validation Utility** (`/utils/validate-data.ts`):
   ```typescript
   import { readFileSync } from 'fs'
   import { join } from 'path'
   import { ModelsCollectionSchema, CategoriesCollectionSchema } from '~/schemas/model.schema'

   export function validateDataFiles() {
     try {
       // Validate models.json
       const modelsJson = readFileSync(join(process.cwd(), 'data/models.json'), 'utf-8')
       const modelsData = JSON.parse(modelsJson)
       const modelsResult = ModelsCollectionSchema.safeParse(modelsData)

       if (!modelsResult.success) {
         console.error('❌ models.json validation failed:')
         console.error(modelsResult.error.format())
         process.exit(1)
       }

       // Validate categories.json
       const categoriesJson = readFileSync(join(process.cwd(), 'data/categories.json'), 'utf-8')
       const categoriesData = JSON.parse(categoriesJson)
       const categoriesResult = CategoriesCollectionSchema.safeParse(categoriesData)

       if (!categoriesResult.success) {
         console.error('❌ categories.json validation failed:')
         console.error(categoriesResult.error.format())
         process.exit(1)
       }

       console.log('✅ Data validation passed')
       return { models: modelsResult.data, categories: categoriesResult.data }
     } catch (error) {
       console.error('❌ Data validation error:', error)
       process.exit(1)
     }
   }
   ```

3. **Create Sample categories.json**:
   ```json
   {
     "categories": [
       {
         "id": "nature",
         "name": "Nature",
         "slug": "nature",
         "icon": "tree",
         "description": "Natural elements including trees, plants, rocks, and landscapes"
       },
       {
         "id": "architecture",
         "name": "Architecture",
         "slug": "architecture",
         "icon": "building",
         "description": "Buildings, structures, and architectural elements"
       },
       {
         "id": "characters",
         "name": "Characters",
         "slug": "characters",
         "icon": "user",
         "description": "Character models for games and animations"
       },
       {
         "id": "vehicles",
         "name": "Vehicles",
         "slug": "vehicles",
         "icon": "car",
         "description": "Cars, planes, boats, and other vehicles"
       },
       {
         "id": "props",
         "name": "Props",
         "slug": "props",
         "icon": "box",
         "description": "Various props and objects for scene decoration"
       }
     ]
   }
   ```

4. **Create Sample models.json** (5 sample models):
   ```json
   {
     "models": [
       {
         "id": "model-2",
         "name": "Low Poly Tree",
         "slug": "low-poly-tree",
         "description": "A stylized low-poly tree perfect for game environments. Features hand-painted textures and optimized geometry for real-time rendering.",
         "thumbnail": "/thumbnails/tree-2.jpg",
         "modelUrl": "/models/tree-2.glb",
         "formats": [
           { "type": "GLB", "size": "2.4MB", "url": "/models/tree-2.glb" }
         ],
         "category": "nature",
         "tags": ["tree", "low-poly", "game-ready", "PBR"],
         "polycount": 1200,
         "createdAt": "2025-10-01T10:00:00Z",
         "updatedAt": "2025-10-15T14:30:00Z",
         "downloads": 245,
         "license": "CC BY 4.0",
         "author": "Sample Artist",
         "seo": {
           "title": "Low Poly Tree 3D Model - Free Download",
           "description": "Download free low-poly tree 3D model in GLB format. Perfect for game development, perfect for indie games and mobile applications.",
           "keywords": ["3d tree model", "low poly", "game asset", "free glb"]
         }
       }
       // ... 4 more sample models
     ]
   }
   ```

5. **Add Build Hook** (in `nuxt.config.ts`):
   ```typescript
   export default defineNuxtConfig({
     // ... other config

     hooks: {
       'build:before': () => {
         console.log('Validating data files...')
         import('./utils/validate-data').then(({ validateDataFiles }) => {
           validateDataFiles()
         })
       }
     }
   })
   ```

6. **Download Sample Assets**:
   - Download 5 free GLB models from Poly Haven or Sketchfab
   - Create placeholder thumbnails (can use screenshots from model-viewer)
   - Organize in /public/models and /public/thumbnails

### Key Considerations
- **Data Integrity**: Zod validation ensures runtime safety
- **Build-time Validation**: Fail fast if data is corrupted
- **Type Safety**: Auto-generated TypeScript types from Zod schemas
- **Scalability**: JSON structure supports 500-1000 models
- **SEO**: Each model has SEO metadata for better discoverability

### Code Locations/Files Affected
- New files:
  - `/schemas/model.schema.ts`
  - `/utils/validate-data.ts`
  - `/data/models.json`
  - `/data/categories.json`
  - `/public/models/*.glb` (sample files)
  - `/public/thumbnails/*.jpg` (sample images)
- Modified files: `nuxt.config.ts`

## Dependencies
- [ ] Task 2 completed (project setup with Zod installed)
- [ ] Free 3D models downloaded (Poly Haven, Sketchfab)
- [ ] Image editing tool for thumbnails (optional - can use screenshots)

## Effort Estimate
- **Size**: S (Small)
- **Hours**: 6-8 hours
- **Parallel**: false (blocks data-dependent tasks)
- **Complexity**: Low-Medium (schema design requires thought)

### Time Breakdown
- Zod schema design: 2 hours
- Sample data creation: 2 hours
- Validation utilities: 1 hour
- Sample asset gathering: 1-2 hours
- Testing and verification: 1 hour

## Definition of Done
- [ ] Code implemented: All schemas and data files created
- [ ] Tests passing: `pnpm build` runs validation successfully
- [ ] Documentation updated: JSON schema documented
- [ ] Code reviewed: Schema design reviewed for completeness
- [ ] Ready for next tasks: Tasks 4 and 5 can begin
- [ ] Verified: Manual JSON edits fail validation correctly
- [ ] Verified: All sample models load in browser
- [ ] Verified: TypeScript types work in test composable
