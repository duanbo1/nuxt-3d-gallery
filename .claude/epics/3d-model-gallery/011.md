---
name: Performance Optimization
status: open
created: 2025-10-23T05:35:03Z
updated: 2025-10-23T05:35:03Z
github: [Will be updated when synced to GitHub]
depends_on: [005, 006, 008]
parallel: false
conflicts_with: []
---

# Task: Performance Optimization

## Description
Optimize application performance to meet target metrics including bundle splitting for 3D viewer, lazy hydration strategies, image optimization, Core Web Vitals improvements, virtual scrolling for large result sets, and comprehensive Lighthouse audits to achieve 90+ scores across all categories.

## Acceptance Criteria
- [ ] Initial bundle size < 200KB (JS + CSS gzipped)
- [ ] 3D viewer code split into separate chunk
- [ ] Lazy hydration for below-the-fold components
- [ ] Images optimized with WebP format and lazy loading
- [ ] Virtual scrolling implemented for > 100 results
- [ ] Lighthouse Performance score ≥ 90
- [ ] Lighthouse Accessibility score ≥ 95
- [ ] Lighthouse SEO score ≥ 95
- [ ] First Contentful Paint (FCP) < 1.5s
- [ ] Largest Contentful Paint (LCP) < 2.5s
- [ ] Cumulative Layout Shift (CLS) < 0.1
- [ ] Time to Interactive (TTI) < 3.5s
- [ ] Total Blocking Time (TBT) < 300ms

## Technical Details

### Implementation Approach

1. **Bundle Splitting Configuration** (`nuxt.config.ts`):
   ```typescript
   export default defineNuxtConfig({
     // ... existing config

     vite: {
       build: {
         rollupOptions: {
           output: {
             manualChunks: {
               // Split 3D viewer into separate chunk
               'model-viewer': ['@google/model-viewer'],

               // Split search library
               'search': ['fuse.js'],

               // Split comment system
               'comments': ['@giscus/vue']
             }
           }
         }
       }
     },

     // Enable experimental features
     experimental: {
       payloadExtraction: true,
       componentIslands: true
     }
   })
   ```

2. **Lazy Component Loading** (`/components/LazyModelViewer3D.vue`):
   ```vue
   <template>
     <div ref="container" class="lazy-model-viewer">
       <ClientOnly>
         <ModelViewer3D
           v-if="isVisible"
           v-bind="$props"
         />
         <template #fallback>
           <div class="placeholder h-[600px] flex items-center justify-center bg-gray-100">
             <p class="text-gray-600">Loading 3D viewer...</p>
           </div>
         </template>
       </ClientOnly>
     </div>
   </template>

   <script setup lang="ts">
   // Lazy load 3D viewer only when in viewport
   const container = ref<HTMLElement>()
   const isVisible = ref(false)

   onMounted(() => {
     if (!container.value) return

     const observer = new IntersectionObserver(
       (entries) => {
         entries.forEach((entry) => {
           if (entry.isIntersecting) {
             isVisible.value = true
             observer.disconnect()
           }
         })
       },
       { rootMargin: '100px' }
     )

     observer.observe(container.value)

     onBeforeUnmount(() => {
       observer.disconnect()
     })
   })
   </script>
   ```

3. **Image Optimization** (update existing components):
   ```vue
   <!-- In ModelCard.vue and other components -->
   <NuxtImg
     :src="model.thumbnail"
     :alt="model.name"
     format="webp"
     quality="80"
     loading="lazy"
     sizes="sm:100vw md:50vw lg:33vw xl:25vw"
     :placeholder="[16, 16, 75, 5]"
     class="w-full h-full object-cover"
   />
   ```

4. **Virtual Scrolling for Large Lists** (`/composables/useVirtualScroll.ts`):
   ```typescript
   import { useVirtualList } from '@vueuse/core'

   export const useVirtualGrid = <T>(
     items: Ref<T[]>,
     itemHeight: number = 350,
     overscan: number = 5
   ) => {
     const { list, containerProps, wrapperProps } = useVirtualList(
       items,
       {
         itemHeight,
         overscan
       }
     )

     return {
       virtualList: list,
       containerProps,
       wrapperProps
     }
   }
   ```

5. **Update GalleryGrid for Virtual Scrolling** (`/components/GalleryGrid.vue`):
   ```vue
   <template>
     <div class="gallery-grid-container">
       <!-- Use virtual scrolling for large result sets -->
       <div
         v-if="models.length > 100"
         v-bind="containerProps"
         class="virtual-scroll-container"
         style="max-height: 2000px; overflow-y: auto;"
       >
         <div v-bind="wrapperProps">
           <div
             v-for="{ data: model, index } in virtualList"
             :key="model.id"
             class="virtual-item"
           >
             <ModelCard :model="model" />
           </div>
         </div>
       </div>

       <!-- Regular grid for smaller result sets -->
       <div
         v-else
         class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
       >
         <ModelCard v-for="model in models" :key="model.id" :model="model" />
       </div>
     </div>
   </template>

   <script setup lang="ts">
   import type { Model } from '~/schemas/model.schema'

   const props = defineProps<{
     models: Model[]
     // ... other props
   }>()

   // Virtual scrolling for large lists
   const modelList = computed(() => props.models)
   const { virtualList, containerProps, wrapperProps } = useVirtualGrid(modelList)
   </script>
   ```

6. **Font Optimization** (`/app.vue` or layout):
   ```vue
   <script setup lang="ts">
   useHead({
     link: [
       {
         rel: 'preconnect',
         href: 'https://fonts.googleapis.com'
       },
       {
         rel: 'preconnect',
         href: 'https://fonts.gstatic.com',
         crossorigin: ''
       },
       {
         rel: 'stylesheet',
         href: 'https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap',
         media: 'print',
         onload: "this.media='all'"
       }
     ]
   })
   </script>
   ```

7. **Resource Hints** (`nuxt.config.ts`):
   ```typescript
   export default defineNuxtConfig({
     app: {
       head: {
         link: [
           // Preload critical assets
           { rel: 'preload', as: 'font', type: 'font/woff2', crossorigin: 'anonymous' },

           // DNS prefetch for external resources
           { rel: 'dns-prefetch', href: 'https://fonts.googleapis.com' },
           { rel: 'dns-prefetch', href: 'https://giscus.app' }
         ]
       }
     }
   })
   ```

8. **Create Performance Monitoring Script** (`/scripts/lighthouse-ci.sh`):
   ```bash
   #!/bin/bash
   # Run Lighthouse CI for performance monitoring

   # Install Lighthouse CI if not installed
   if ! command -v lhci &> /dev/null; then
       npm install -g @lhci/cli
   fi

   # Run Lighthouse on key pages
   lhci autorun \
     --collect.url="http://localhost:3000" \
     --collect.url="http://localhost:3000/models/low-poly-tree" \
     --collect.numberOfRuns=3 \
     --assert.preset="lighthouse:recommended" \
     --upload.target="temporary-public-storage"

   echo "Lighthouse reports generated!"
   ```

9. **Performance Budget Configuration** (`lighthouserc.json`):
   ```json
   {
     "ci": {
       "collect": {
         "numberOfRuns": 3
       },
       "assert": {
         "preset": "lighthouse:recommended",
         "assertions": {
           "categories:performance": ["error", { "minScore": 0.9 }],
           "categories:accessibility": ["error", { "minScore": 0.95 }],
           "categories:seo": ["error", { "minScore": 0.95 }],
           "first-contentful-paint": ["error", { "maxNumericValue": 1500 }],
           "largest-contentful-paint": ["error", { "maxNumericValue": 2500 }],
           "cumulative-layout-shift": ["error", { "maxNumericValue": 0.1 }],
           "total-blocking-time": ["error", { "maxNumericValue": 300 }]
         }
       }
     }
   }
   ```

10. **Code Splitting Verification Script** (`/scripts/analyze-bundle.sh`):
    ```bash
    #!/bin/bash
    # Analyze bundle size

    # Build with analysis
    NUXT_ANALYZE=true pnpm build

    echo "Bundle analysis complete. Check .nuxt/analyze/ for reports."
    ```

### Key Considerations
- **Progressive Enhancement**: Ensure core functionality works without JS
- **Critical CSS**: Inline critical CSS for above-the-fold content
- **Lazy Loading**: Defer non-critical resources
- **Caching**: Leverage browser caching for static assets
- **Monitoring**: Set up continuous performance monitoring

### Code Locations/Files Affected
- Modified files:
  - `nuxt.config.ts` (bundle splitting, experimental features)
  - `/components/GalleryGrid.vue` (virtual scrolling)
  - `/components/ModelCard.vue` (image optimization)
  - `/pages/models/[slug].vue` (lazy 3D viewer)
- New files:
  - `/components/LazyModelViewer3D.vue`
  - `/composables/useVirtualScroll.ts`
  - `/scripts/lighthouse-ci.sh`
  - `/scripts/analyze-bundle.sh`
  - `lighthouserc.json`
- Packages: Install `@lhci/cli` (dev dependency)

## Dependencies
- [ ] Task 005 completed (gallery UI)
- [ ] Task 006 completed (3D viewer)
- [ ] Task 008 completed (search functionality)

## Effort Estimate
- **Size**: M (Medium)
- **Hours**: 10 hours
- **Parallel**: false (requires complete features)
- **Complexity**: Medium-High

### Time Breakdown
- Bundle splitting configuration: 2 hours
- Lazy loading implementation: 2 hours
- Image optimization: 1 hour
- Virtual scrolling: 2 hours
- Lighthouse audits and fixes: 2 hours
- Testing and validation: 1 hour

## Definition of Done
- [ ] Code implemented: All optimizations applied
- [ ] Tests passing: Performance meets targets
- [ ] Documentation updated: Performance guide created
- [ ] Code reviewed: Optimization strategies verified
- [ ] Ready for production: Performance validated
- [ ] Verified: Initial bundle < 200KB
- [ ] Verified: Lighthouse scores meet targets
- [ ] Verified: Core Web Vitals pass
- [ ] Verified: Virtual scrolling works for large lists
- [ ] Verified: Images load as WebP with lazy loading
- [ ] Verified: 3D viewer lazy loads correctly
