---
name: 3D Model Preview System
status: open
created: 2025-10-23T05:35:03Z
updated: 2025-10-23T05:35:03Z
github: [Will be updated when synced to GitHub]
depends_on: [002, 003]
parallel: true
conflicts_with: [005]
---

# Task: 3D Model Preview System

## Description
Integrate @google/model-viewer for WebGL-based 3D model rendering. Create the ModelViewer3D component with interactive controls, implement the model detail page with SSG pre-rendering, add error handling with fallback thumbnails, and ensure mobile touch gesture support for optimal viewing experience.

## Acceptance Criteria
- [ ] @google/model-viewer web component integrated
- [ ] `ModelViewer3D.vue` component with lazy loading
- [ ] `/pages/models/[slug].vue` detail page with SSG
- [ ] Interactive controls: rotate (drag), zoom (scroll), pan (shift+drag)
- [ ] Reset view and fullscreen buttons
- [ ] Loading progress indicator during model fetch
- [ ] Error state with fallback thumbnail
- [ ] Mobile touch gestures (pinch-zoom, rotate)
- [ ] Environment lighting with HDRI
- [ ] Auto-rotate on initial load (optional toggle)

## Technical Details

### Implementation Approach

1. **Create ModelViewer3D Component** (`/components/ModelViewer3D.vue`):
   ```vue
   <template>
     <div class="model-viewer-container relative">
       <!-- Loading state -->
       <div
         v-if="isLoading"
         class="absolute inset-0 flex items-center justify-center bg-gray-100 dark:bg-gray-800"
       >
         <div class="text-center">
           <div class="spinner mb-2"></div>
           <p class="text-sm text-gray-600">Loading 3D model...</p>
           <p class="text-xs text-gray-500">{{ loadProgress }}%</p>
         </div>
       </div>

       <!-- Error state -->
       <div
         v-if="hasError"
         class="absolute inset-0 flex items-center justify-center bg-gray-100 dark:bg-gray-800"
       >
         <div class="text-center">
           <IconError class="w-12 h-12 mx-auto mb-2 text-red-500" />
           <p class="text-sm text-gray-600 mb-2">Failed to load 3D model</p>
           <img
             v-if="fallbackImage"
             :src="fallbackImage"
             :alt="alt"
             class="max-w-full max-h-64 mx-auto mb-2"
           />
           <button
             @click="retry"
             class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600"
           >
             Retry
           </button>
         </div>
       </div>

       <!-- Model viewer (lazy loaded) -->
       <ClientOnly>
         <model-viewer
           ref="viewerRef"
           :src="modelUrl"
           :alt="alt"
           :poster="poster"
           camera-controls
           touch-action="pan-y"
           auto-rotate
           :auto-rotate-delay="3000"
           shadow-intensity="1"
           environment-image="neutral"
           exposure="1"
           class="w-full h-full"
           @load="onLoad"
           @error="onError"
           @progress="onProgress"
         >
           <!-- Controls slot -->
           <div class="controls absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2">
             <button
               @click="resetCamera"
               class="px-3 py-2 bg-white/90 hover:bg-white rounded-md shadow-md text-sm"
               title="Reset view"
             >
               <IconReset class="w-5 h-5" />
             </button>

             <button
               @click="toggleAutoRotate"
               class="px-3 py-2 bg-white/90 hover:bg-white rounded-md shadow-md text-sm"
               title="Toggle auto-rotate"
             >
               <IconRotate :class="{ 'text-blue-500': autoRotateEnabled }" class="w-5 h-5" />
             </button>

             <button
               @click="toggleFullscreen"
               class="px-3 py-2 bg-white/90 hover:bg-white rounded-md shadow-md text-sm"
               title="Fullscreen"
             >
               <IconFullscreen class="w-5 h-5" />
             </button>
           </div>

           <!-- Loading progress bar -->
           <div
             v-if="isLoading"
             class="progress-bar absolute bottom-0 left-0 right-0 h-1 bg-gray-200"
           >
             <div
               class="h-full bg-blue-500 transition-all duration-300"
               :style="{ width: `${loadProgress}%` }"
             ></div>
           </div>
         </model-viewer>

         <template #fallback>
           <div class="w-full h-full flex items-center justify-center bg-gray-100">
             <p class="text-gray-600">Loading 3D viewer...</p>
           </div>
         </template>
       </ClientOnly>
     </div>
   </template>

   <script setup lang="ts">
   // Import model-viewer types
   import '@google/model-viewer'

   const props = defineProps<{
     modelUrl: string
     alt: string
     poster?: string
     fallbackImage?: string
   }>()

   const viewerRef = ref<any>(null)
   const isLoading = ref(true)
   const hasError = ref(false)
   const loadProgress = ref(0)
   const autoRotateEnabled = ref(true)

   const onLoad = () => {
     isLoading.value = false
     hasError.value = false
   }

   const onError = (event: any) => {
     console.error('Model viewer error:', event)
     isLoading.value = false
     hasError.value = true
   }

   const onProgress = (event: any) => {
     const percentComplete = event.detail.totalProgress * 100
     loadProgress.value = Math.round(percentComplete)
   }

   const resetCamera = () => {
     if (viewerRef.value) {
       viewerRef.value.resetTurntableRotation()
       viewerRef.value.cameraOrbit = viewerRef.value.interpolationDecay = '0deg 75deg 105%'
     }
   }

   const toggleAutoRotate = () => {
     if (viewerRef.value) {
       autoRotateEnabled.value = !autoRotateEnabled.value
       viewerRef.value.autoRotate = autoRotateEnabled.value
     }
   }

   const toggleFullscreen = () => {
     if (viewerRef.value) {
       if (document.fullscreenElement) {
         document.exitFullscreen()
       } else {
         viewerRef.value.requestFullscreen()
       }
     }
   }

   const retry = () => {
     hasError.value = false
     isLoading.value = true
     // Force reload by updating src
     if (viewerRef.value) {
       const currentSrc = viewerRef.value.src
       viewerRef.value.src = ''
       nextTick(() => {
         viewerRef.value.src = currentSrc
       })
     }
   }
   </script>

   <style scoped>
   .model-viewer-container {
     width: 100%;
     height: 600px;
   }

   @media (max-width: 768px) {
     .model-viewer-container {
       height: 400px;
     }
   }

   model-viewer {
     width: 100%;
     height: 100%;
   }

   .spinner {
     border: 3px solid rgba(0, 0, 0, 0.1);
     border-top-color: #3b82f6;
     border-radius: 50%;
     width: 40px;
     height: 40px;
     animation: spin 1s linear infinite;
   }

   @keyframes spin {
     to { transform: rotate(360deg); }
   }
   </style>
   ```

2. **Create Model Detail Page** (`/pages/models/[slug].vue`):
   ```vue
   <template>
     <div class="container mx-auto px-4 py-8">
       <!-- Loading state -->
       <div v-if="!model" class="text-center py-12">
         <div class="spinner mx-auto mb-4"></div>
         <p>Loading model...</p>
       </div>

       <!-- Model detail -->
       <div v-else>
         <!-- Breadcrumb -->
         <nav class="mb-4 text-sm">
           <NuxtLink to="/" class="text-blue-500 hover:underline">Gallery</NuxtLink>
           <span class="mx-2">/</span>
           <NuxtLink :to="`/category/${model.category}`" class="text-blue-500 hover:underline">
             {{ getCategoryName(model.category) }}
           </NuxtLink>
           <span class="mx-2">/</span>
           <span class="text-gray-600">{{ model.name }}</span>
         </nav>

         <!-- Model info header -->
         <div class="mb-6">
           <h1 class="text-3xl font-bold mb-2">{{ model.name }}</h1>
           <p class="text-gray-600 mb-4">{{ model.description }}</p>

           <div class="flex items-center gap-4 text-sm text-gray-500">
             <span>By {{ model.author }}</span>
             <span>•</span>
             <span>{{ formatDate(model.createdAt) }}</span>
             <span>•</span>
             <span>{{ model.downloads }} downloads</span>
           </div>
         </div>

         <!-- 3D Viewer -->
         <ModelViewer3D
           :model-url="model.modelUrl"
           :alt="model.name"
           :poster="model.thumbnail"
           :fallback-image="model.thumbnail"
           class="mb-6 rounded-lg overflow-hidden shadow-lg"
         />

         <!-- Model metadata and download -->
         <div class="grid md:grid-cols-3 gap-6 mb-8">
           <!-- Metadata -->
           <div class="md:col-span-2 bg-white dark:bg-gray-800 rounded-lg p-6 shadow">
             <h2 class="text-xl font-semibold mb-4">Details</h2>

             <dl class="grid grid-cols-2 gap-4 text-sm">
               <div>
                 <dt class="text-gray-500 mb-1">Category</dt>
                 <dd class="font-medium">{{ getCategoryName(model.category) }}</dd>
               </div>

               <div>
                 <dt class="text-gray-500 mb-1">Polycount</dt>
                 <dd class="font-medium">{{ formatNumber(model.polycount) }}</dd>
               </div>

               <div>
                 <dt class="text-gray-500 mb-1">Formats</dt>
                 <dd class="font-medium">
                   {{ model.formats.map(f => f.type).join(', ') }}
                 </dd>
               </div>

               <div>
                 <dt class="text-gray-500 mb-1">License</dt>
                 <dd class="font-medium">{{ model.license }}</dd>
               </div>
             </dl>

             <!-- Tags -->
             <div class="mt-4">
               <h3 class="text-sm text-gray-500 mb-2">Tags</h3>
               <div class="flex flex-wrap gap-2">
                 <span
                   v-for="tag in model.tags"
                   :key="tag"
                   class="px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-sm"
                 >
                   #{{ tag }}
                 </span>
               </div>
             </div>
           </div>

           <!-- Download section -->
           <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow">
             <h2 class="text-xl font-semibold mb-4">Download</h2>

             <div class="space-y-3">
               <DownloadButton
                 v-for="format in model.formats"
                 :key="format.type"
                 :model-id="model.id"
                 :format="format"
                 class="w-full"
               />
             </div>

             <p class="text-xs text-gray-500 mt-4">
               By downloading, you agree to the {{ model.license }} license terms.
             </p>
           </div>
         </div>

         <!-- Related models -->
         <div v-if="relatedModels.length > 0">
           <h2 class="text-2xl font-bold mb-4">Related Models</h2>
           <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
             <ModelCard
               v-for="related in relatedModels"
               :key="related.id"
               :model="related"
             />
           </div>
         </div>

         <!-- Comments section (placeholder for task 010) -->
         <div class="mt-12">
           <h2 class="text-2xl font-bold mb-4">Comments</h2>
           <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-8 text-center">
             <p class="text-gray-500">Comments will be integrated in a later task</p>
           </div>
         </div>
       </div>
     </div>
   </template>

   <script setup lang="ts">
   const route = useRoute()
   const slug = route.params.slug as string

   const { getModelBySlug, getRelatedModels } = useModels()
   const { getCategoryName } = useCategories()

   const model = computed(() => getModelBySlug(slug))
   const relatedModels = computed(() => getRelatedModels(slug, 4))

   // 404 if model not found
   if (!model.value) {
     throw createError({
       statusCode: 404,
       statusMessage: 'Model not found'
     })
   }

   // SEO
   useSeoMeta({
     title: model.value.seo.title,
     description: model.value.seo.description,
     keywords: model.value.seo.keywords.join(', '),
     ogTitle: model.value.name,
     ogDescription: model.value.description,
     ogImage: model.value.thumbnail,
     ogType: 'website'
   })

   // JSON-LD structured data
   useHead({
     script: [
       {
         type: 'application/ld+json',
         children: JSON.stringify({
           '@context': 'https://schema.org',
           '@type': '3DModel',
           name: model.value.name,
           description: model.value.description,
           image: model.value.thumbnail,
           encodingFormat: 'model/gltf-binary',
           author: {
             '@type': 'Person',
             name: model.value.author
           },
           license: model.value.license
         })
       }
     ]
   })

   const formatDate = (date: string) => {
     return new Date(date).toLocaleDateString('en-US', {
       year: 'numeric',
       month: 'long',
       day: 'numeric'
     })
   }

   const formatNumber = (num?: number) => {
     if (!num) return 'N/A'
     return num.toLocaleString()
   }
   </script>
   ```

3. **Configure SSG Route Generation** (add to `nuxt.config.ts`):
   ```typescript
   export default defineNuxtConfig({
     // ... existing config

     hooks: {
       async 'nitro:config'(nitroConfig) {
         // Generate static routes for all models
         const models = await import('./data/models.json').then(m => m.default)

         if (!nitroConfig.prerender) {
           nitroConfig.prerender = { routes: [] }
         }

         // Add all model detail pages
         for (const model of models.models) {
           nitroConfig.prerender.routes?.push(`/models/${model.slug}`)
         }
       }
     }
   })
   ```

### Key Considerations
- **Performance**: Lazy load model-viewer component, progressive loading for large models
- **Error Handling**: Graceful fallback to thumbnails
- **Mobile UX**: Touch gestures, optimized viewport height
- **SEO**: JSON-LD structured data, proper meta tags
- **Accessibility**: Keyboard controls, ARIA labels

### Code Locations/Files Affected
- New files:
  - `/components/ModelViewer3D.vue`
  - `/pages/models/[slug].vue`
- Modified files: `nuxt.config.ts`
- Package: Install `@google/model-viewer`

## Dependencies
- [ ] Task 002 completed (data schemas)
- [ ] Task 003 completed (composables)
- [ ] @google/model-viewer npm package installed

## Effort Estimate
- **Size**: L (Large)
- **Hours**: 16 hours
- **Parallel**: true (complex but independent)
- **Complexity**: High (3D integration, SSG configuration)
- **Conflicts with**: Task 005 (both modify pages/components)

### Time Breakdown
- ModelViewer3D component: 6 hours
- Model detail page: 4 hours
- SSG route generation: 2 hours
- Error handling and loading states: 2 hours
- Mobile optimization: 2 hours

## Definition of Done
- [ ] Code implemented: All components complete
- [ ] Tests passing: Manual testing on multiple devices
- [ ] Documentation updated: Component usage documented
- [ ] Code reviewed: Performance and error handling verified
- [ ] Ready for use: Can view any model in 3D
- [ ] Verified: 3D viewer works on desktop and mobile
- [ ] Verified: All model pages pre-rendered with SSG
- [ ] Verified: Error states display fallback thumbnails
- [ ] Verified: Touch gestures work on mobile devices
- [ ] Verified: SEO meta tags and JSON-LD present
